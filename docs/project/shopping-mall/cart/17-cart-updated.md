---
layout: default
title: "[cart] ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ìˆ˜ëŸ‰ UPDATE"
parent: cart
nav_order: 17
---



#### $(document).trigger("cart:updated"); ëŠ” jQueryì˜ **ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ë°œìƒ ì½”ë“œ**ì…ë‹ˆë‹¤.


`detail.php`ì—ì„œ â€œì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°â€ ì„±ê³µ í›„ **í—¤ë” ì¹´ìš´íŠ¸ë§Œ ì¦‰ì‹œ ê°±ì‹ **í•˜ë ¤ë©´, ì•„ë˜ì²˜ëŸ¼ **ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°(cart:updated)**ë¥¼ ê·¸ëŒ€ë¡œ í™œìš©í•˜ë©´ ë©ë‹ˆë‹¤. í•µì‹¬ì€ **ì¶”ê°€ API ì‘ë‹µì— cart_countë¥¼ í¬í•¨**í•´ ì£¼ê³ , ì—†ì„ ë•ŒëŠ” **í—¤ë”ê°€ ì§ì ‘ ì¹´ìš´íŠ¸ë¥¼ ì¡°íšŒ**í•˜ëŠ” ë‘ ê°€ì§€ ê²½ë¡œë¥¼ ë‹¤ ì—¬ëŠ” ê±°ì˜ˆìš”.

### 1) detail.php (ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° â†’ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°)
```html
<!-- detail.php (ì˜ˆì‹œ) -->
<button id="btnAddToCart">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>

<script>
// jQuery ì‚¬ìš© ì˜ˆì‹œ
$('#btnAddToCart').on('click', function () {
  const payload = {
    action: 'add',                 // ì„œë²„ API ì„¤ê³„ì— ë§ê²Œ
    product_id: $('#product_id').val(),
    quantity: Number($('#qty').val() || 1),
    // ì˜µì…˜/ì¶”ê°€êµ¬ì„± ë“±ì´ ìˆìœ¼ë©´ í•¨ê»˜ ì „ì†¡
    // option_json: JSON.stringify(...),
  };

  $.post('/api/cart_proc.php', payload)
    .done(function (resp) {
      // resp ì˜ˆì‹œ: { ok: true, cart_count: 5 }
      if (resp && resp.ok) {
        // (A) ì‘ë‹µì— cart_count ìˆìœ¼ë©´ ê°™ì´ ë³´ë‚´ê¸°
        $(document).trigger('cart:updated', [resp.cart_count]);
        // UX í”¼ë“œë°±
        toast('ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤.');
      } else {
        alert(resp?.msg || 'ë‹´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    })
    .fail(function () {
      alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});
</script>

```

ë§Œì•½ jQueryê°€ ì•„ë‹ˆë¼ `fetch`ë¥¼ ì“°ì‹ ë‹¤ë©´, `then`ì—ì„œ ë™ì¼í•˜ê²Œ `document.dispatchEvent(new CustomEvent('cart:updated', { detail: { count } }))` í˜•íƒœë¡œ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.

# 2) header.php (ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¡œ ë±ƒì§€ ê°±ì‹ )

í—¤ë”ëŠ” ë‘ ê°€ì§€ë¥¼ ì²˜ë¦¬í•˜ë©´ ì•ˆì •ì ì…ë‹ˆë‹¤.

- **ì¼€ì´ìŠ¤ A:** `detail.php`ê°€ ìƒˆ ì¹´ìš´íŠ¸ë¥¼ **ë„˜ê²¨ì¤€ ê²½ìš°** â†’ ê·¸ëŒ€ë¡œ ë°˜ì˜
    
- **ì¼€ì´ìŠ¤ B:** ìƒˆ ì¹´ìš´íŠ¸ê°€ **ì—†ìœ¼ë©´** â†’ **APIë¡œ ì¹´ìš´íŠ¸ ì¬ì¡°íšŒ** í›„ ë°˜ì˜
```html
<!-- header.php (ì˜ˆì‹œ) -->
<span id="cartCountBadge" class="badge">0</span>

<script>
// ì¹´ìš´íŠ¸ í‘œì‹œ ìœ í‹¸
function renderCartCount(n) {
  const $badge = $('#cartCountBadge');
  $badge.text(n);
  $badge.toggleClass('hidden', !n);
}

// ì„œë²„ì—ì„œ ì¹´ìš´íŠ¸ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²½ëŸ‰ API ê¶Œì¥ (ì˜ˆ: action=count)
function fetchCartCount() {
  return $.get('/api/cart_proc.php', { action: 'count' })
    .then(function (resp) {
      // resp ì˜ˆì‹œ: { ok: true, cart_count: 5 }
      if (resp && resp.ok) return resp.cart_count ?? 0;
      return 0;
    })
    .catch(function () { return 0; });
}

// 1) í˜ì´ì§€ ì´ˆê¸° ì§„ì… ì‹œ 1íšŒ ë™ê¸°í™”(ì„ íƒ)
$(function () {
  fetchCartCount().then(renderCartCount);
});

// 2) ì¥ë°”êµ¬ë‹ˆ ë³€ê²½ ì´ë²¤íŠ¸ë¥¼ ì–´ë””ì„œë“  ìˆ˜ì‹ 
$(document).on('cart:updated', function (_evt, newCount) {
  if (typeof newCount === 'number') {
    // ì¼€ì´ìŠ¤ A: detail.phpê°€ ë„˜ê²¨ì¤€ ì¹´ìš´íŠ¸ ì‚¬ìš©
    renderCartCount(newCount);
  } else {
    // ì¼€ì´ìŠ¤ B: ì§ì ‘ ì¡°íšŒ
    fetchCartCount().then(renderCartCount);
  }
});
</script>

```

# 3) êµ¬í˜„ íŒ

- **ì‘ë‹µì— cart_count ë„£ê¸° ê¶Œì¥**: ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€/ì‚­ì œ/ìˆ˜ì • APIì—ì„œ ë§¤ë²ˆ ìµœì‹  ì¹´ìš´íŠ¸ë¥¼ ë‚´ë ¤ì£¼ë©´ **ì¶”ê°€ ì¡°íšŒ ì—†ì´ ì¦‰ì‹œ ë°˜ì˜** ê°€ëŠ¥.
    
- **ë””ë°”ìš´ìŠ¤(ì„ íƒ)**: ì‚¬ìš©ìê°€ ë¹ ë¥´ê²Œ ì—¬ëŸ¬ ë²ˆ ë‹´ì„ ë•Œ ì´ë²¤íŠ¸ë¥¼ ë„ˆë¬´ ìì£¼ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ 200~400ms ë””ë°”ìš´ìŠ¤.
    
- **ë¯¸ë‹ˆì¹´íŠ¸ ë™ê¸°í™”(ì„ íƒ)**: í—¤ë” ë°°ì§€ë¿ ì•„ë‹ˆë¼ ë¯¸ë‹ˆì¹´íŠ¸ ëª©ë¡ì„ ì“°ì‹ ë‹¤ë©´ `cart:updated`ì—ì„œ ëª©ë¡ë„ ë¶€ë¶„ ê°±ì‹ .
    
- **ì—ëŸ¬ ì‹œ ì›ë³µ**: ë‚™ê´€ì  UIë¥¼ ì“°ë©´, ì‹¤íŒ¨ ì‹œ ì´ì „ ì¹´ìš´íŠ¸ë¡œ ë˜ëŒë¦¬ëŠ” ì²˜ë¦¬(ë˜ëŠ” ì¬ì¡°íšŒ) í¬í•¨.



êµ¬ì²´ì ìœ¼ë¡œ:

1. **ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°ë§**
    
    - `document` ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ `"cart:updated"`ë¼ëŠ” ì´ë¦„ì˜ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
        
    - ì´ ì‹œì ì—ì„œ ì‹¤ì œë¡œ ì•„ë¬´ ë™ì‘ë„ í•˜ì§€ ì•Šê³ , ë‹¨ìˆœíˆ **"ì§€ê¸ˆ cart:updatedë¼ëŠ” ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆë‹¤"**ë¼ëŠ” ì‹ í˜¸ë¥¼ ë˜ì§„ ê²ƒ.
        
2. **ë¦¬ìŠ¤ë„ˆì™€ ì—°ê²°**
    
    - ë‹¤ë¥¸ ì½”ë“œì—ì„œ `$(document).on("cart:updated", function (event, data) { ... })` ê°™ì€ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•´ë‘ë©´, íŠ¸ë¦¬ê±°ëœ ìˆœê°„ í•´ë‹¹ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.
        
    - ì˜ˆ: `header.php` ê°™ì€ ê³³ì—ì„œ ì´ ì´ë²¤íŠ¸ë¥¼ ë“£ê³  ì¥ë°”êµ¬ë‹ˆ ì¹´ìš´íŠ¸ ë±ƒì§€ë¥¼ ìƒˆë¡œ ê·¸ë ¤ì¤Œ.
        
3. **ë°ì´í„° ì „ë‹¬ë„ ê°€ëŠ¥**
    
    - `$(document).trigger("cart:updated", [5]);` ì²˜ëŸ¼ ë‘ ë²ˆì§¸ ì¸ìë¡œ ë°°ì—´/ê°’ì„ ë„£ìœ¼ë©´ ë¦¬ìŠ¤ë„ˆ ìª½ì—ì„œ `function (event, newCount) { ... }` í˜•íƒœë¡œ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        
    - ì¦‰ â€œì¥ë°”êµ¬ë‹ˆê°€ ê°±ì‹ ëë‹¤ â†’ í˜„ì¬ ì¹´ìš´íŠ¸ëŠ” 5ê°œâ€ë¼ëŠ” ì‹ì˜ ì •ë³´ê¹Œì§€ í•¨ê»˜ ì „ë‹¬ ê°€ëŠ¥.
        
4. **ì¥ì **
    
    - **ê²°í•©ë„ ë‚®ìŒ**: detail.php, basket.php, header.php ê°™ì€ íŒŒì¼ì´ ì„œë¡œ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šê³ ë„, â€œì´ë²¤íŠ¸â€ë¼ëŠ” ë§¤ê°œì²´ë¡œ í†µì‹  ê°€ëŠ¥.
        
    - **ì—¬ëŸ¬ êµ¬ë…ì ì§€ì›**: header ë±ƒì§€, ë¯¸ë‹ˆì¹´íŠ¸ íŒì—…, í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ë“± ì—¬ëŸ¬ ëª¨ë“ˆì´ ë™ì‹œì— cart:updatedë¥¼ êµ¬ë…í•´ ë°˜ì‘ ê°€ëŠ¥.
        

---

ğŸ‘‰ ì •ë¦¬í•˜ë©´,  
`$(document).trigger("cart:updated");` ëŠ” **â€œì¥ë°”êµ¬ë‹ˆ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìœ¼ë‹ˆ ê´€ì‹¬ ìˆëŠ” ëª¨ë“ˆì€ ì•Œì•„ì„œ ë°˜ì‘í•´ë¼â€**ë¼ëŠ” ì‹ í˜¸ë¥¼ broadcastí•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.